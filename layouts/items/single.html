{{ define "main" }}
<div class="container">
    {{ partial "category-tabs.html" . }}
    
    <nav class="breadcrumb">
        <a href="{{ .Site.BaseURL }}">‚Üê Back to Items</a>
    </nav>

    <article class="item-detail">
        <header class="item-header">
            <h1>{{ .Title }}</h1>
            {{ if .Params.sold }}
            <span class="sold-badge">SOLD</span>
            {{ end }}
        </header>

        <div class="item-content">
            <div class="item-images">
                {{ if .Params.images }}
                <div class="image-gallery">
                    {{ range $index, $image := .Params.images }}
                    <img src="{{ $image | relURL }}" alt="{{ $.Title }}" class="gallery-image clickable-image" data-index="{{ $index }}">
                    {{ end }}
                </div>
                {{ else if .Params.thumbnail }}
                <img src="{{ .Params.thumbnail | relURL }}" alt="{{ .Title }}" class="main-image clickable-image" data-index="0">
                {{ else }}
                <div class="no-image">
                    <span>No images available</span>
                </div>
                {{ end }}
            </div>

            <div class="item-details">
                <div class="item-meta">
                    {{ if .Params.price }}
                    <div class="meta-item">
                        <strong>Price:</strong> {{ .Site.Params.currency }}{{ .Params.price }}
                    </div>
                    {{ end }}
                    
                    {{ if .Params.condition }}
                    <div class="meta-item">
                        <strong>Condition:</strong> {{ .Params.condition }}
                    </div>
                    {{ end }}
                    
                    {{ if .Params.categories }}
                    <div class="meta-item">
                        <strong>Categories:</strong>
                        <div class="meta-categories">
                            {{ range .Params.categories }}
                            <span class="item-category">{{ . }}</span>
                            {{ end }}
                        </div>
                    </div>
                    {{ else if .Params.category }}
                    <div class="meta-item">
                        <strong>Category:</strong> {{ .Params.category }}
                    </div>
                    {{ end }}
                    
                    <div class="meta-item">
                        <strong>Listed:</strong> {{ .Date.Format "January 2, 2006" }}
                    </div>
                    
                    {{ if .Params.carousell }}
                    <div class="meta-item">
                        <strong>Also available on:</strong> <a href="{{ .Params.carousell }}" target="_blank" class="carousell-link">Carousell</a>
                    </div>
                    {{ end }}
                </div>

                <div class="item-description">
                    {{ .Content }}
                </div>

                {{ if not .Params.sold }}
                {{ partial "contact-seller.html" . }}
                {{ end }}
            </div>
        </div>
    </article>

    <!-- Image Modal -->
    <div id="imageModal" class="image-modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <button class="modal-nav modal-prev" id="modalPrev">&#8249;</button>
            <img id="modalImage" src="" alt="">
            <button class="modal-nav modal-next" id="modalNext">&#8250;</button>
            <div class="modal-counter">
                <span id="modalCounter">1 / 1</span>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('imageModal');
    const modalImage = document.getElementById('modalImage');
    const modalClose = document.querySelector('.modal-close');
    const modalPrev = document.getElementById('modalPrev');
    const modalNext = document.getElementById('modalNext');
    const modalCounter = document.getElementById('modalCounter');
    const clickableImages = document.querySelectorAll('.clickable-image');
    
    let currentImageIndex = 0;
    let images = [];
    
    // Collect all image sources
    clickableImages.forEach(img => {
        images.push(img.src);
    });
    
    function showModal(index) {
        currentImageIndex = index;
        modalImage.src = images[currentImageIndex];
        modalImage.alt = clickableImages[currentImageIndex].alt;
        updateCounter();
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }
    
    function hideModal() {
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
    }
    
    function updateCounter() {
        modalCounter.textContent = `${currentImageIndex + 1} / ${images.length}`;
        modalPrev.style.display = images.length > 1 ? 'block' : 'none';
        modalNext.style.display = images.length > 1 ? 'block' : 'none';
    }
    
    function showNextImage() {
        currentImageIndex = (currentImageIndex + 1) % images.length;
        modalImage.src = images[currentImageIndex];
        modalImage.alt = clickableImages[currentImageIndex].alt;
        updateCounter();
    }
    
    function showPrevImage() {
        currentImageIndex = (currentImageIndex - 1 + images.length) % images.length;
        modalImage.src = images[currentImageIndex];
        modalImage.alt = clickableImages[currentImageIndex].alt;
        updateCounter();
    }
    
    // Event listeners
    clickableImages.forEach((img, index) => {
        img.addEventListener('click', () => showModal(index));
    });
    
    modalClose.addEventListener('click', hideModal);
    modalNext.addEventListener('click', showNextImage);
    modalPrev.addEventListener('click', showPrevImage);
    
    // Close modal when clicking outside the image
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            hideModal();
        }
    });
    
    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
        if (modal.style.display === 'flex') {
            switch(e.key) {
                case 'Escape':
                    hideModal();
                    break;
                case 'ArrowLeft':
                    showPrevImage();
                    break;
                case 'ArrowRight':
                    showNextImage();
                    break;
            }
        }
    });
});
</script>
{{ end }}
{{ $categories := slice }}
{{ range where .Site.RegularPages "Section" "items" }}
  {{ if .Params.category }}
    {{ $categories = $categories | append .Params.category }}
  {{ end }}
{{ end }}
{{ $categories = $categories | uniq | sort }}

{{ if gt (len $categories) 0 }}
<nav class="category-tabs">
  <div class="tabs-container">
    <a href="{{ "/" | relURL }}" class="tab {{ if .IsHome }}active{{ end }}">
      All Items
    </a>
    {{ range $categories }}
    {{ $categorySlug := . | urlize }}
    {{ $isActive := false }}
    {{ if $.Params.category }}
      {{ if eq ($.Params.category | urlize) $categorySlug }}
        {{ $isActive = true }}
      {{ end }}
    {{ end }}
    {{ if and (not $.IsHome) (eq $.Title (. | title)) }}
      {{ $isActive = true }}
    {{ end }}
    <a href="{{ "/categories/" | relURL }}{{ $categorySlug }}/" class="tab {{ if $isActive }}active{{ end }}">
      {{ . }}
    </a>
    {{ end }}
  </div>
</nav>
{{ end }}